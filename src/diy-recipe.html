<link rel="import" href="/bower_components/polymer/polymer-element.html">
<link rel="import" href="/bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="/bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="/bower_components/iron-icon/iron-icon.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/iron-icons/image-icons.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">

<link rel="import" href="/src/functional/diy-user-cache.html">
<link rel="import" href="/src/mixins/mixin-common.html">
<link rel="import" href="/src/mixins/mixin-redux.html">
<link rel="import" href="/src/mixins/mixin-static-data.html">
<link rel="import" href="/src/theme/diy-theme.html">
<link rel="import" href="/src/diy-flavor-action.html">
<link rel="import" href="/src/diy-flavor-actions.html">
<link rel="import" href="/src/diy-vendor-popup.html">
<link rel="import" href="/src/diy-recipe-mixer.html">

<dom-module id="diy-recipe">
  <link rel="import" type="css" href="diy-recipe.css">
  <template>
    <style include="iron-flex iron-flex-alignment"></style>
    <style include="diy-theme"></style>

    <diy-user-cache uid="[[recipe.user]]" name="{{recipeAuthor}}">
    </diy-user-cache>

    <div id="header" class="layout horizontal center">
      <h2>[[recipe.name]]</h2>
      <iron-icon
          id="isPublicIndicator"
          icon="icons:visibility-off"
          title="Unlisted Recipe"
          hidden="[[recipe.isPublic]]">
      </iron-icon>
      <div class="flex"></div>

      <div class="actions layout horizontal" hidden="[[!showRecipeMixer]]">
        <paper-button raised on-tap="onToggleMixer_" title="Close Mixer">
          <iron-icon icon="icons:arrow-back"></iron-icon>
        </paper-button>
      </div>

      <div class="actions layout horizontal" hidden="[[showRecipeMixer]]">
        <paper-button raised on-tap="onToggleMixer_" title="Mix recipe">
          <iron-icon icon="image:colorize"></iron-icon>
        </paper-button>
        <paper-button
            raised
            hidden="[[!isAuthenticated_(authUserId, recipe.user)]]"
            on-tap="onEditTap_"
            title="Edit recipe">
          <iron-icon icon="icons:create"></iron-icon>
        </paper-button>
        <paper-button
            raised
            hidden="[[!isAuthenticated_(authUserId, recipe.user)]]"
            on-tap="onDeleteTap_"
            title="Delete recipe">
          <iron-icon icon="icons:delete"></iron-icon>
        </paper-button>
      </div>
    </div>

    <div id="content" hidden="[[showRecipeMixer]]">
      <!-- Details with author and created timestamp. -->
      <div id="details" class="layout horizontal justified">
        <span>Recipe by [[recipeAuthor]]</span>
        <span>created [[recipeTimestamp]]</span>
      </div>

      <!-- The list of ingredients in a table. -->
      <div id="ingredients" class="layout vertical" >
        <!-- Notice when there are no ingredients. -->
        <div hidden$="[[hasIngredients]]">
          No ingredients here. That's odd!
        </div>
        <!-- List of ingredients. -->
        <div hidden$="[[!hasIngredients]]">
          <table>
            <template is="dom-repeat" items="[[ingredients]]">
              <tr>
                <td class="percent">[[formatFixed(item.percent)]]%</td>
                <td class="vendor" on-tap="onVendorTap_">
                  <span>[[item.vendor.short]]</span>
                </td>
                <td class="flavor">[[item.flavor.name]]</td>
                <td class="actions">
                  <diy-flavor-action
                      flavor="[[item.flavor.key]]"
                      role="button"
                      on-tap="onActionTap_">
                  </diy-flavor-action>
                </td>
              </tr>
            </template>
            <tr class="separator-row">
              <td class="percent">[[totalFlavoring_(ingredients)]]%</td>
              <td colspan="3">Total flavoring</td>
            </tr>
          </table>
        </div>
      </div>

      <!-- The recipe description. -->
      <div hidden$="[[!hasDescription]]">
        <b>Description:</b> [[recipe.description]]
      </div>
    </div>

    <!-- The recipe mixer has expensive UI, use dom-if for efficiency. -->
    <template is="dom-if" if="[[showRecipeMixer]]" restamp>
      <diy-recipe-mixer ingredients="[[ingredients]]"></diy-recipe-mixer>
    </template>

    <!-- Popup when vendor information is requested. -->
    <diy-vendor-popup id="vendorPopup"></diy-vendor-popup>

    <!-- Dropdown for flavor actions (inventory, whishlist). -->
    <diy-flavor-actions id="flavorActions"></diy-flavor-actions>

  </template>
  <script type="text/javascript" src="diy-recipe.js"></script>
</dom-module>
